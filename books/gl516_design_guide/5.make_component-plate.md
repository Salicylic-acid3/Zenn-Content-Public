---
title: "⌨スイッチプレートから実装プレートを作成する"
---

# ０．本チャプターのゴール

本チャプターが完了すると部品を実装する実装プレートが完成します。
![](/images/gl516design/5-95_assemble-plate-7.png)
一番長いチャプターですが、順序立ててやれば難しくは無いと思います。
頑張ってください。

# １．スイッチプレートをフォルダごとコピーし、実装プレートフォルダを作成する

- スイッチプレートフォルダ`01_Top`をコピーする。
![](/images/gl516design/5-1_assemble-plate-1.png)

- 実装プレートとわかりやすい名前、`02_Assemble`などにリネームする。
![](/images/gl516design/5-2_assemble-plate-2.png)

# ２．回路図を作成する

GL516のテンプレートを使用する場合、回路図を新しく書く必要はほとんどありません。
テンプレートに配置してあるシンボルを削除してアノテーションし直すだけで大丈夫です。

- 拡張子が`.pro`のファイルをダブルクリックして開く。
![](/images/gl516design/5-3_assemble-plate-3.png)

- 画面左側にある、拡張子が`.sch`のファイルをダブルクリックして開く。
![](/images/gl516design/5-4_assemble-plate-4.png)

- 回路図とKLEのレイアウトデータを比較し、余分なスイッチを削除する。
![](/images/gl516design/5-5_assemble-plate-5.png)

- 欲しいLEDの数だけを残し、LEDを削除する。
![](/images/gl516design/5-6_assemble-plate-6.png)

:::details Tips:LEDの数と難易度ついて
LEDの数は配線の難易度に直結しますので、最初からフルキーバックライト[^1]に挑戦すると後の配線の工程で詰まる可能性があります。
光の眷属の方以外は、まずはLEDは少なめで始めた方がいいと思います。
:::
[^1]: 全てのキーに裏から照らすLEDを設定すること。

:::details Tips:ロータリーエンコーダの追加
ロータリーエンコーダを追加する場合、キーマトリクスの中のキースイッチのシンボルとロータリーエンコーダのシンボルを入れ替え、ロータリーエンコーダ用のラベルを付与します。
シンボルを消すだけの手順ではなくなるので少し難易度が上がりますので、最初に手順をよく確認してください。
- 画面右の`シンボルを配置`ボタンを押す。
![](/images/gl516design/5-7_rotary-encoder-1.png)
- 回路図内の何もない部分をクリックすると`シンボルを選択`画面が表示されるので、シンボルの検索バーで`Rotary`と入力し`Rotary_Encoder_Switch`を選択して`OK`をクリックする。
![](/images/gl516design/5-8_rotary-encoder-2.png)
- ロータリーエンコーダのシンボルをキースイッチのシンボルと入れ替える。
入れ替える際は、`R`キーでシンボルを回転させながら下写真のように入れる。
![](/images/gl516design/5-9_rotary-encoder-3.png)
- 入れ替えたロータリーエンコーダのシンボルとキーマトリクスの配線を接続する。
![](/images/gl516design/5-10_rotary-encoder-4.png)
![](/images/gl516design/5-11_rotary-encoder-5.png)
- GNDのシンボルを追加する。
シンボルの検索バーで`GND`と入力し、`GND`をダブルクリックする。
![](/images/gl516design/5-12_rotary-encoder-6.png)
- GNDのシンボルは`R`キーで回転させてロータリーエンコーダの`C`のピンに接続する。
![](/images/gl516design/5-13_rotary-encoder-7.png)
- `A1` `B1`のラベルを追加する。
画面右の`グローバルラベルの追加`ボタンを押して、画面の何もない部分をクリックし、ラベルを追加する。
![](/images/gl516design/5-14_rotary-encoder-8.png)
![](/images/gl516design/5-15_rotary-encoder-9.png)
- ロータリーエンコーダのシンボルにラベルを接続する。
![](/images/gl516design/5-16_rotary-encoder-10.png)
- BLE Micro Proのシンボルの空いているピン（`☓`が付与されているピン）の`☓`を削除し、ロータリーエンコーダ用のラベルを接続する。
![](/images/gl516design/5-17_rotary-encoder-11.png)
:::message
BLE Micro Proの空いているピンならどこでもOKですが、BMP使用時に13ピンのピンヘッダが必要になってしまうため、右下の`B6/PIN13`は使用しないほうが無難です。
:::

# ３．回路図をアノテーションし直す

- `ツール`→`回路図をアノテーション`をクリックする。
![](/images/gl516design/5-18_annotation-1.png)

- `アノテーションをクリア`をクリックする。
![](/images/gl516design/5-19_annotation-2.png)

- `アノテーションをクリア`をクリックする。
![](/images/gl516design/5-20_annotation-3.png)

- `アノテーション`をクリックする。
![](/images/gl516design/5-21_annotation-4.png)

- 削除したスイッチの前後の順番が連番に戻っていることを確認する。
![](/images/gl516design/5-22_annotation-5.png)

# ４．回路図をチェックする

- `検査`→`エレクトリカル ルール チェッカー`をクリックする。
![](/images/gl516design/5-23_erc-1.png)

- `実行`をクリックする。
![](/images/gl516design/5-24_erc-2.png)

- 右上のメッセージ欄に`終了`とだけ出力されることを確認する。
![](/images/gl516design/5-25_erc-3.png)

:::details Tips:エラーメッセージが出力される場合
一列削除した場合やLEDをまるごと削除した場合等、以下のようなメッセージが表示されることがあります。
![](/images/gl516design/5-26_erc-4.png)
このような場合は不要になったラベルを削除して未接続フラグを付与することでエラーを解消できます。
![](/images/gl516design/5-27_erc-5.png)
![](/images/gl516design/5-28_erc-6.png)
:::

# ５．フットプリントを関連付けする

- `ツール`→`フットプリントを関連付け`をクリックする。
![](/images/gl516design/5-29_footprint-1.png)

- 使用したいダイオードのタイプを選択し、ダブルクリックして置き換える。
![](/images/gl516design/5-30_footprint-2.png)

:::details Tips:画面例の様にズラッとフットプリントが表示されない場合
画面例の様にズラッとフットプリントが表示されない場合、フットプリントフィルターが機能している場合があります。
`ライブラリーでフットプリントを絞り込み`を選択すると同様の表示になります。
![](/images/gl516design/5-93_footprint-4.png)
:::

:::details Tips:ダイオードのタイプ
![](/images/gl516design/5-31_diode-1.png)
*Diode_SMD：表面実装タイプのダイオード*
![](/images/gl516design/5-32_diode-2.png)
*Diode_TH：スルーホールタイプのダイオード*
![](/images/gl516design/5-33_diode-3.png)
*Diode_TH_SMD：表面実装・スルーホール複合タイプのダイオード*
:::

- レイアウトのSWリファレンス番号に応じてスイッチの大きさを選択し、ダブルクリックして置き換える。
![](/images/gl516design/4-27_sw-plate-27.png)
![](/images/gl516design/5-34_footprint-3.png)

:::details Tips:ロータリーエンコーダの追加
ロータリーエンコーダを追加する場合は該当するキースイッチのシンボルと紐つけるフットプリントを以下のものにします。
![](/images/gl516design/5-94_rotaryencoder-1.png)
*kbd_Parts/RotaryEncoder_EC12E*
:::message
このフットプリントはEC11Eにも対応しています。
:::

# ６．保存する

ここまで来る間に何度か保存していると思いますが、ここで一旦保存しておきます。
`Ctrl + S`で保存できます。

# ７．Pcbnewでフットプリントを置換する

- KiCadのメイン画面左側の拡張子が`.kicad_pcb`をクリックする。
![](/images/gl516design/5-35_pcbnew-1.png)

- Pcbnew画面の`ツール`→`回路図から基板を更新`をクリックする。
![](/images/gl516design/5-36_pcbnew-2.png)

- Pcbnew画面の`リファレンスでフットプリントを再関連付け`→`フットプリント更新`を選択し、`基板を更新`をクリックする。
![](/images/gl516design/5-37_pcbnew-3.png)

- カーソルにダイオードやBLE Micro Proのフットプリントがくっついてくるので、画面外でクリックして仮置する。
![](/images/gl516design/5-38_pcbnew-4.png)

- キーのサイズが間違っていないか確認する。
間違っていたら前工程のフットプリントの関連付けから見直す。

- 回転しているキースイッチがあればキースイッチの向きを揃える。

:::details Tips:キースイッチの向きの種類
キーの向きによってメリット・デメリットがあるため、必要な向きで並べるようにしましょう。
また、キーごとに向きが異なるように並べるのはハンダ付け時の間違いの元なので、基本的にはやめましょう。
- 基本となる向き「South facing」
![](/images/gl516design/5-39_switch-1.png)
メリット：全てのキーキャップに適合できる。
デメリット：文字透過式のキーキャップの文字部分にLEDの光を効率的に当てることが不可能。
コメント：迷ったらこの向き。
- 文字部分を光らせたい時に「Noth facing」
![](/images/gl516design/5-40_switch-2.png)
メリット：文字部分にLEDの光を効率的に当てることができる。
デメリット：CherryプロファイルのキーキャップのA列Z列でキースイッチとキーキャップが当たるため、打鍵感が低下する。
コメント：Cherryプロファイルが好きな人にとっては買わない理由になるほど。
　　　　　LEDを搭載しない場合は選ばないほうがいい。
　　　　　日本語配列かつCherryプロファイルのキーキャップは非常に稀なので筆者の設計する日本語配列キーボードはこの向きを採用していることもある。
- 避けたほうがよい「East/West facing」
![](/images/gl516design/5-41_switch-3.png)
コメント：ソケットを採用し、複数のレイアウトを実現できるようなPCBでたまに見られる90°回転させたスイッチの向き。
　　　　　実はスイッチの軸の十字には縦と横が設定され、それぞれサイズが異なるために90°回転させたスイッチに無理にキーキャップをはめると割れたり穴がガバガバになったりする。
　　　　　やめたほうがいい。
:::

:::details Tips:2u以上のキーの向きを揃える
2u以上のキー用のフットプリントはスタビライザー用の穴が付いているため、スイッチプレートの作成の際に回転させている可能性があります。
その場合、以下の図のようにスイッチ部分だけ反対側を向いている場合が生じてしまいます。
![](/images/gl516design/5-42_switch-4.png)
以下の手順でスイッチの向きを修正します。
- 変更するスイッチを選択し、`E`キーを押す。

- プロパティ画面の`フットプリントを変更`ボタンを押す。
![](/images/gl516design/5-43_switch-3.png)

- `新しいフットプリント識別子`の右側の本棚のようなボタンを押す。
![](/images/gl516design/5-44_switch-4.png)

- ライブラリ`kbd_SW`の`CherryMX_Hotswap_2.25u_Rev`をダブルクリックする。
![](/images/gl516design/5-45_switch-5.png)

- `変更`ボタンを押し、フットプリントが更新されるのを確認したら`閉じる`ボタンを押す。
![](/images/gl516design/5-46_switch-6.png)
![](/images/gl516design/5-47_switch-7.png)
:::message alert
2u以上のキーは絶対に`R`キーなどでキーを回転させてはいけません。
実装プレートだけスイッチの向きを回転すると、組立時にスタビライザーとスイッチプレートが干渉します。
:::

# ８．BLE Micro Proのフットプリントを配置する

- 右上か左上にBLE Micro Proのフットプリントを配置する。
紫色の線がギリギリ重ならないように配置する。
![](/images/gl516design/5-48_putting-1.png)
:::message alert
BLE Micro Proのコネクタ（BMPと書いてある側）は必ず基板内側を向くように配置してください。
:::
:::message
BLE Micro Proを設置できるポイントはテンプレートの以下の部分です。
![](/images/gl516design/5-49_putting-2.png)
パネルマウントケーブルを利用する場合はなるべく左右端に近づけたほうがケーブルを無理なく接続できます。
:::
:::message
BLE Micro Proとスイッチのフットプリントの位置関係は作例を参考にしてください。
:::

- BLE Micro Proに重なる部分のスイッチのフットプリントを変更する。
    - BLE Micro Proに重なる部分のスイッチを選択し、`E`キーを押す。

    - プロパティ画面の`フットプリントを変更`ボタンを押す。
![](/images/gl516design/5-50_putting-3.png)

    - `新しいフットプリント識別子`の右側の本棚のようなボタンを押す。
![](/images/gl516design/5-51_putting-4.png)

    - ライブラリ`kbd_SW`の`CherryMX_Hotswap_1.0u_Small1`をダブルクリックする。
![](/images/gl516design/5-52_putting-5.png)

    - `変更`ボタンを押し、フットプリントが更新されるのを確認したら`閉じる`ボタンを押す。
![](/images/gl516design/5-53_putting-6.png)

# ９．実装プレートの外形を変更する

実装プレートはスイッチプレートに比べて小さい外形が必要です。
フットプリントを配置していく前に外形を実装プレートの外形に合わせます。

- 不要な注意書きや線を削除する。
![](/images/gl516design/5-54_outline-1.png)
最終的には以下の線だけ残します。
![](/images/gl516design/5-55_outline-2.png)
![](/images/gl516design/5-56_outline-3.png)
:::message
スイッチプレートの外形の横の線（黄色い線）だけ残してください。
:::

- F.Fabの線を外形線（Edge.Cuts）に変更する。
    - 灰色のF.Fabの線を選択し、`E`キーで円弧、または配線セグメントのプロパティを開く
![](/images/gl516design/5-57_outline-4.png)

    - レイヤーで`Edge.Cuts`を選択し、`OK`を押す
![](/images/gl516design/5-58_outline-5.png)
![](/images/gl516design/5-59_outline-6.png)
![](/images/gl516design/5-60_outline-7.png)

    - 横の外形線を円弧に接続する。
    外形線を選択した後、外形線の端を円弧の端にドラッグして接続する。
![](/images/gl516design/5-61_outline-8.png)
:::message
上記図の様に、接続できた場合は接続点に○が表示されます。
○が表示されない時は接続されていないので注意が必要です。
:::
:::details Tips:外形線の接続
外形線の接続は大きめのグリッドを使用すると簡単にできます。
筆者は外形線を接続する際は、ユーザー定義した2.3813mmのグリッドをよく使用します。
または横の外形線を選択して`E`キーを押してプロパティを開き、直接`始点X`と`終点X`を入力する事で接続できます。
![](/images/gl516design/5-62_outline-9.png)
始点X：320.625
終点X：22.275
※始点終点は入れ替わってもOKです。
:::
- 3Dビューアーで基板外形が閉じられているか確認する。
    - `表示`→`3Dビューアー`をクリックし、3Dビューアーを起動する
![](/images/gl516design/5-63_outline-10.png)

    - 正常に表示できたらOK。
![](/images/gl516design/5-64_outline-11.png)

    - エラーメッセージが表示されたらその座標を確認する。
![](/images/gl516design/5-65_outline-12.png)
![](/images/gl516design/5-66_outline-13.png)

:::details Tips:座標の確認方法
画面下にマウスカーソルがいる座標が表示されています。
![](/images/gl516design/5-67_outline-14.png)
他にも未配線数などの情報も有益なので覚えておきましょう。
:::

# １０．部品のフットプリントを配置する
## １０－１．ダイオードを配置する

ダイオードをドラッグして並べていきます。
この時、定義したグリッド（2.3813mm）を使用すると綺麗に並べることができます。
ダイオードは、リファレンス番号を確認し、同じ番号のスイッチの近くに置くと配線とキーが反応しない時のデバッグが楽になります。
![](/images/gl516design/5-68_putting-7.png)

:::details Tips:ダイオードの向き
ダイオードの向きは基本的には揃えたほうがベターです。
一部のダイオードだけ向きを変えてしまうと実装時に向きを間違えてしまう可能性があります。
思いの外、印刷されたシルクプリントを見ていない場合が多いのです。
:::

## １０－２．LEDを配置する

LEDをドラッグして並べていきます。
この時、定義したグリッド（2.3813mm）を使用すると綺麗に並べることができます。
![](/images/gl516design/5-69_putting-8.png)
LEDはシリアル（直列）に繋いでいくので、キースイッチのリファレンス番号とは合わせずに、マイコンから近い順に、一筆書きでかけるように並べていくと配線が簡単です。
![](/images/gl516design/5-70_putting-9.png)

:::details Tips:LEDを光らせる順番
ファームウェア側でなにもしないとLEDは並べた順番に光ります。
よって、光らせたい順番にLEDを並べると任意の順番に光らせることができますが、ファームウェアで工夫をすることで順番を変更することができます。
ただし、本書ではテンプレートを使ったファームウェアの書き方を紹介するため、LEDの点灯順の変更は紹介しません。
配線よりファームウェアの方が自信がない！というかたは光らせたい順番に並べても勿論OKです。
:::

## １０－３．リセットスイッチを配置する

リセットスイッチをドラッグして配置します。
この時、定義したグリッド（2.3813mm）を使用すると綺麗に並べることができます。
![](/images/gl516design/5-71_putting-10.png)
配線が大変なのでできるだけProMicroの近くに配置しましょう。

## １０－４．電池用ワイヤー穴を配置する

電池用ワイヤー穴をドラッグして配置します。
電池用のバックプレートとの接続のため、できるだけ上側の真ん中あたりに配置してください。
![](/images/gl516design/5-72_putting-11.png)

:::details Tips:なぜ端子が3つもあるのか
電池との接続は本来+と-の2つの端子があればいいのですが、このフットプリントでは3つに分けています。
これは電池用バックプレートのコネクターを上下逆に付けてしまった時に+と-の逆転を防ぐためです。
-、+、-と並んでいたら上下逆に接続しても問題ないのです。
人間、どれだけ気をつけてもミスする時はミスしますからね。。。
:::

# １１．0.5mmの配線を定義する

いよいよ配線ですが、まずは配線の種類を知っておきましょう。
配線は電力線と信号線の2種類に分けることができます。
電力線は通る電力の10分の1の太さの線を使う必要があります。
ProMicroは5V仕様なので、0.5mmという線を定義します。

- Pcbnewウインドウの左上の`配線:0.25 mm`と書かれている部分をクリックし、`定義されているサイズを編集`をクリックする。
![](/images/gl516design/5-73_wiring-1.png)

- 基板セットアップウィンドウの配線の欄の下の`+（プラス）`ボタンをクリックし、`0.5mm`と入力し、`OK`をクリックする。
![](/images/gl516design/5-74_wiring-2.png)

- もう一度`配線:0.25 mm`をクリックすると`配線:0.5mm`を選択できるようになっているので、クリックして選択する。
![](/images/gl516design/5-75_wiring-3.png)

# １２．配線する

:::message
いきなり綺麗に配線することは「ほぼ不可能」です。
何度か引き直すことを前提に、気軽にどんどん配線していきましょう。
:::

## １２－１．VCCの配線

VCCの線はビア[^2]をなるべく使用しない方がいいので、最初に配線してしまいます。
配線の太さは0.5mmを使用します。

[^2]: 基板の表と裏の配線をつなげるための穴。
ビアを多数配置するとノイズが乗る可能性があるので、無闇な設置は禁物。
ただしビアを使わなすぎて大きく迂回してもノイズが乗るので、バランスが重要。

- レイヤーマネージャーで`B.Cu`を選択してから`配線`をクリックし、BLE Micro ProのVCC端子をクリックして線を引いていく。
配線自体はつなぐべき部分だけ明るくなって教えてくれるので、VCCの配線は後の配線に比べて難しくない。
![](/images/gl516design/5-76_wiring-4.png)
![](/images/gl516design/5-77_wiring-5.png)

サンプルの配線例も見ておくとイメージがしやすい。
![](/images/gl516design/5-78_wiring-6.png)
![](/images/gl516design/5-79_wiring-7.png)

## １２－２．GNDの配線

GNDからはビアを使用しないと綺麗に引けませんので使用していきます。
ビアを使用する際は配線中に`V`キーを押すことでビア設置モードになり、ビア設置後は反対側のレイヤーに移動して配線を継続できます。
![](/images/gl516design/5-80_wiring-8.png)

サンプルの配線例も見ておくとイメージがしやすいので、是非見ておいてください。
![](/images/gl516design/5-81_wiring-9.png)
![](/images/gl516design/5-82_wiring-10.png)

## １２－３．信号線の配線

信号線は0.25mmを使用するので左上の`配線:0.5mm`をクリックし、`配線:0.25mm`を選択して配線します。

:::details Tips:綺麗に配線するためのコツ
配線ポリシーを事前に決めておくと綺麗に配線できます。
例えば縦の配線は`F.Cu`を、横の配線は`B.Cu`を基本的に使う、というようなポリシーです。
もちろんビアを使用しても大丈夫です。
また、前工程で配線した電力線も信号線の配線に邪魔ならズラしてOKです。
:::

:::details Tips:斜めのフットプリントへの配線
通常の配線モードは45°単位でしか線を曲げられないのですが、45°以外の角度で傾いたキーには通常の配線モードでは綺麗に配線できません。
そこで配線の曲げたいところにカーソルを合わせて`G`キーを押すことで配線を自由角度で直す事ができます。
![](/images/gl516design/5-83_wiring-11.png)
:::

:::details Tips:作例の信号線が太い理由
ソケットのパッドの剥がれ防止です。
ソケットはスイッチの挿入や打鍵される方向に対して、ハンダの接合力のみで耐えています。
よって出来る限りハンダの量を増やすためにパッドを大きくし、基板との接合力を増すために1.0mmで信号線を接続しています。
この工夫については特に真似しなくても大丈夫です。
:::

:::details Tips:鋭角の配線
鋭角（90°以下の角度）で曲がる配線は基板の不良率にも影響する[^3]ので販売予定なら是非直してください。
配線を分岐する際もなるべく90°未満の角ができないようにしたほうが製造不良による断線が起きづらいので、販売を考えている場合はこれも気をつけたほうが良いです。
また、90°になっている部分も配線を追加して鈍角になるようにしたほうがより良いです。
[^3]:銅箔を全面に施された生基板にエッチング液を吹き付けて銅箔を部分的に溶かして配線を形成するが、液体なので表面張力が存在する。
表面張力により液だまりが発生すると予定した配線より細くなってしまい、断線しやすくなることがある。
:::

:::details Tips:Freeroutingについて
配線はパズルのように面白い時もありますし、面倒くさい時もあります。
面倒くさい時は[Freerouting](https://github.com/freerouting/freerouting)というツールを使用することもできます。
Freeroutingのインストーラーは[こちら](https://github.com/freerouting/freerouting/releases)です。
https://github.com/freerouting/freerouting/releases
ただし、Freeroutingは配線の種類ごとに先の太さを変更したり、ビアの優先順位を変更することができません。
LEDを採用する場合は予め電力線だけは先に配線しておくことをオススメします。
:::

# １３．チェックする

- 未配線が無いことを確認する。
画面下に未配線数が出ているので0であることを確認する。
![](/images/gl516design/5-84_check-1.png)

:::message
未配線箇所が分からない場合は次のデザインルールチェッカーで確認します。
:::

- `検査`→`デザインルールチェッカー`でデザインルールチェッカーを起動する。
![](/images/gl516design/5-85_check-2.png)

- `DRCを実行`をクリックして`問題/マーカー`と`未配線アイテム`の右に`0`が表示されていることを起動する。
![](/images/gl516design/5-86_check-3.png)

:::message alert
特に未配線アイテムの部分を見逃しやすいので注意してください。
:::

:::message
エラーがある場合は以下のように表示されます。
![](/images/gl516design/5-87_check-4.png)
エラー内容をクリックすると該当箇所にジャンプします。
問題箇所を修正してデザインルールチェッカーを再実行ください。
:::

# １４．シルクの調整をする

シルク[^4]は組立時に有用な情報なだけでなく、ちゃんと書けばデバッグ時に基板の設計データを見なくて済むようになるので、是非ちゃんと調整しておきましょう。
[^4]: 基板にシルク印刷した文字や図柄のことをシルクと呼ぶ。

- 他のフットプリントに重なっている部分のシルク文字を移動する。
![](/images/gl516design/5-88_silk-1.png)

- バージョン情報や基板の情報を記入する。
![](/images/gl516design/5-89_silk-2.png)
![](/images/gl516design/5-90_silk-3.png)
![](/images/gl516design/5-91_silk-4.png)
*基板裏に印字する場合は`ミラー`へのチェックを忘れないようにしましょう*

:::message
バージョン情報は結構大事です。
特に頒布する際にはバージョンごとに対応を変える必要がある場合があるため、必ず入れましょう。
:::

- 3Dビューアーを起動してシルクが読めるか確認する。
![](/images/gl516design/5-92_silk-5.png)

